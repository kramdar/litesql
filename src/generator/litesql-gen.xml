<!DOCTYPE actions SYSTEM "flexml-act.dtd">
<actions>
<top><![CDATA[
#include "xmlobjects.hpp"
#include "litesql-gen-main.hpp"
#include "litesql-gen.hpp"

using namespace std;
using namespace xml;
vector<Object> objects;
vector<Relation> relations;
Database db;
Object * obj;
Relation * rel;
Field * fld;
Method * mtd;
Index * idx;
]]></top>
<start tag="database"><![CDATA[
db.name = safe({name});
db.include = safe({include});
db.version = safe({version});
db.nspace = safe({namespace});
]]></start>
<start tag="object"><![CDATA[
objects.push_back(Object({name}, safe({inherits})));
obj = &objects[objects.size()-1];
]]></start>
<end tag="object"><![CDATA[
obj = NULL;
]]></end>
<start tag="relation"><![CDATA[
relations.push_back(Relation(safe({id}), safe({name}),{unidir}));
rel = &relations[relations.size()-1];
]]></start>
<end tag="relation"><![CDATA[
rel = NULL;
]]></end>
<start tag="field"><![CDATA[
if (obj) {
    obj->fields.push_back(Field({name}, 
                                     {type},safe({default}),{indexed},{unique}));
    fld = &obj->fields[obj->fields.size()-1];
} else if (rel) {
    rel->fields.push_back(Field({name}, 
                         {type},safe({default}),{indexed}, {unique}));
    fld = &rel->fields[rel->fields.size()-1];
}
]]></start>
<start tag="index"><![CDATA[
if (obj) {
    obj->indexes.push_back(Index({unique}));
    idx = &obj->indexes[obj->indexes.size()-1];
} else if (rel) {
    rel->indexes.push_back(Index({unique}));
    idx = &rel->indexes[rel->indexes.size()-1];
} 
]]></start>
<end tag="index"><![CDATA[
idx = NULL;
]]></end>
<start tag="indexfield"><![CDATA[
if (idx)
    idx->fields.push_back(IndexField({name}));
]]></start>
<start tag="value"><![CDATA[
if (fld) 
    fld->value(Value({name}, {value}));
]]></start>
<end tag="field"><![CDATA[
fld = NULL;
]]></end>
<start tag="method"><![CDATA[
if (obj) {
    obj->methods.push_back(Method({name}, safe({returntype})));
    mtd = &obj->methods[obj->methods.size()-1];
}
]]></start>
<end tag="method"><![CDATA[
mtd = NULL;
]]></end>
<start tag="param"><![CDATA[
if (mtd) 
    mtd->param(Param({name}, {type}));
]]></start>
<start tag="relate"><![CDATA[
if (rel)
    rel->related.push_back(Relate({object}, {limit}, {unique}, safe({handle})));
]]></start>
<end tag="database"><![CDATA[
    generateCode(db, objects, relations);    
]]></end>
<main><![CDATA[
extern FILE * yyin;
int main(int argc, char **argv) {
    return litesql_gen_main(argc, argv, &yyin);
}
]]></main>
</actions>
